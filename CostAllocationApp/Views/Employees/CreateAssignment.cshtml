
@{
    ViewBag.Title = "Create Assignment";
}

<div class="content container-fluid">
    <!-- /Page Header -->
    <div class="row">
        <div class="col-md-12">
            <table id="add_name_search" class="custom_add_name">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Section</th>
                        <th>Department</th>
                        <th>In-Charge</th>
                        <th>Role</th>
                        <th>Explanation</th>
                        <th>Company</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <input type="text" class="form-control" id="identity_search" placeholder="name">
                        </td>
                        <td>
                            <select id="section_search" class="form-control">
                            </select>
                        </td>
                        <td>
                            <select id="department_search" class="form-control">
                            </select>
                        </td>
                        <td>
                            <select id="incharge_search" class="form-control">
                            </select>
                        </td>
                        <td>
                            <select id="role_search" class="form-control">
                            </select>
                        </td>
                        <td>
                            <select id="explanation_search" class="form-control">
                            </select>
                        </td>
                        <td>
                            <select id="company_search" class="form-control">
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="7"></td>
                        <td>
                            <a href="javascript:void(0);" class="" id="add_name_search_button">Search</a>
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 custom_add_name">
            <a href="javascript:void(0);" data-toggle="modal" data-target="#modal_add_name_new">add_name</a>
            <table id="add_name_table_1">
                <thead>
                    <tr>
                        <th>SL</th>
                        <th>Name</th>
                        <th>Memo</th>
                        <th>Section</th>
                        <th>Department</th>
                        <th>In-Charge</th>
                        <th>Role</th>
                        <th>Explanation</th>
                        <th>Company</th>
                        <th>Grade</th>
                        <th>Unit Price</th>
                        <th>Action</th>
                    </tr>
                    @*<tr>
                        <th></th>
                        <th>
                            <input type="text" class="form-control col-12" id="edit_employee_name" value="sudipto" placeholder="name">
                        </th>
                        <th></th>
                        <th>
                            <select id="section" class="form-control col-12">
                                <option value="">Select Section</option>
                                <option value="">Section-1</option>
                                <option value="">Section-2</option>
                                <option value="">Section-3</option>
                            </select>
                        </th>
                        <th>
                            <select id="department" class="form-control col-12">
                                <option value="">Select Department</option>
                                <option value="">Department-1</option>
                                <option value="">Department-2</option>
                                <option value="">Department-3</option>
                            </select>
                        </th>
                        <th>
                            <select id="incharge" class="form-control col-12">
                                <option value="">Select In-Charge</option>
                                <option value="">Work Domain-1</option>
                                <option value="">Work Domain-2</option>
                                <option value="">Work Domain-3</option>
                            </select>
                        </th>
                        <th>
                            <select id="role" class="form-control col-12">
                                <option value="">Select Role</option>
                                <option value="">Role-1</option>
                                <option value="">Role-2</option>
                                <option value="">Role-3</option>
                            </select>
                        </th>
                        <th></th>
                        <th>
                            <select id="company" class="form-control col-12">
                                <option value="">Select Company</option>
                                <option value="" selected>Company-1</option>
                                <option value="">Company-2</option>
                                <option value="">Company-3</option>
                            </select>
                        </th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>*@
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>

</div>



<!-- Modal Add Name -->
<div class="modal fade" id="modal_add_name" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Name</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="col-12 modal-body">
                <table id="add_name_table_2">
                    <thead>
                        <tr>
                            <th>SL</th>
                            <th>Name</th>
                            <th>Sub Code</th>
                            @*<th>Memo</th>*@
                            <th>Section</th>
                            <th>Department</th>
                            <th>In-Charge</th>
                            <th>Role</th>
                            <th>Explanation</th>
                            <th>Company</th>
                            <th>Grade</th>
                            <th>Unit Price</th>
                            <th>Action</th>
                        </tr>
                        <tr id="fixed_employee_info">
                            <td>1<input type="hidden" id="fixed_hidden_name" /></td>
                            <td id="fixed_name"></td>
                            <td>1</td>
                            @*<td id="fixed_memo"></td>*@
                            <td id="fixed_section"></td>
                            <td id="fixed_department"></td>
                            <td id="fixed_incharge"></td>
                            <td id="fixed_role"></td>
                            <td id="fixed_explain"></td>
                            <td id="fixed_company"></td>
                            <td id="fixed_grade"></td>
                            <td id="fixed_unitprice"></td>
                            <td><a href="javascript:void(0);" id="add_new_row" onclick="addNew()">add</a></td>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div class="add_name_tbl_2_btn">
                    <a href="javascript:void(0);" class="" id="add_name_add" onclick="onSave()">Add</a>
                    <a href="javascript:void(0);" class="" id="add_name_cancel" data-dismiss="modal">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Modal Add Name (New) -->
<div class="modal fade" id="modal_add_name_new" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Name</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="col-12 modal-body">
                <table id="add_name_table_new">
                    <thead>
                        <tr>
                            <th>Name</th>
                            @*<th>Memo</th>*@
                            <th>Section</th>
                            <th>Department</th>
                            <th>In-Charge</th>
                            <th>Role</th>
                            <th>Explanation</th>
                            <th>Company</th>
                            <th>Grade</th>
                            <th>Unit Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <input type="text" class="form-control col-12" id="identity_new"  placeholder="name">
                            </td>

                            @*<td>
                                <input type="text" class="form-control col-12" id="memo_new"  placeholder="memo">
                            </td>*@
                            <td>
                                <select id="section_new" class="form-control col-12">
                                </select>
                            </td>
                            <td>
                                <select id="department_new" class="form-control col-12">
                                </select>
                            </td>
                            <td>
                                <select id="incharge_new" class="form-control col-12">
                                </select>
                            </td>
                            <td>
                                <select id="role_new" class="form-control col-12"></select>
                            </td>
                            <td>
                                <select id="explanation_new" class="form-control col-12"></select>
                            </td>
                            <td>
                                <select id="company_new" class="form-control col-12">
                                </select>
                            </td>
                            <td>
                                <input type="text" class="form-control col-12" id="grade_new" data-id="0"  placeholder="grade" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control col-12" id="unitprice_new"  placeholder="unit price">
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="add_name_tbl_2_btn">
                    <a href="javascript:void(0);" class="" id="add_name_add_new">Add</a>
                    <a href="javascript:void(0);" class="" id="add_name_cancel" data-dismiss="modal">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal Edit Name -->
<div class="modal fade" id="modal_edit_name" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit Info of <span id="edit_model_span"></span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="col-12 modal-body">
                <table id="add_name_table_3">
                    <thead>
                        <tr>
                            @*<th>Name</th>
                            <th>Memo</th>*@
                            <th>Section</th>
                            <th>Department</th>
                            <th>In-Charge</th>
                            <th>Role</th>
                            <th>Explanation</th>
                            <th>Company</th>
                            <th>Grade</th>
                            <th>Unit Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            @*<td>
                                <input type="text" class="form-control col-12" id="identity" value="Chandra Shekhar Das" placeholder="name">
                            </td>
                            <td>
                                <input type="text" class="form-control col-12" id="memo" value="memo-1" placeholder="memo">
                            </td>*@
                            <td>
                                <input type="hidden" value="" id="row_id_hidden_edit" />
                                <select id="section_edit" class="form-control col-12">
                                    <option value="">Select Section</option>
                                    <option value="" selected>Section-1</option>
                                    <option value="">Section-2</option>
                                    <option value="">Section-3</option>
                                </select>
                            </td>
                            <td>
                                <select id="department_edit" class="form-control col-12">
                                    <option value="">Select Department</option>
                                    <option value="" selected>Department-1</option>
                                    <option value="">Department-2</option>
                                    <option value="">Department-3</option>
                                </select>
                            </td>
                            <td>
                                <select id="incharge_edit" class="form-control col-12">
                                    <option value="">Select In-Charge</option>
                                    <option value="" selected>Work Domain-1</option>
                                    <option value="">Work Domain-2</option>
                                    <option value="">Work Domain-3</option>
                                </select>
                            </td>
                            <td>
                                <select id="role_edit" class="form-control col-12">
                                    <option value="">Select Role</option>
                                    <option value="" selected>Role-1</option>
                                    <option value="">Role-2</option>
                                    <option value="">Role-3</option>
                                </select>
                            </td>
                            <td>
                                <select id="explanation_edit" class="form-control col-12">
                                    <option value="">Select Company</option>
                                    <option value="" selected>Company-1</option>
                                    <option value="">Company-2</option>
                                    <option value="">Company-3</option>
                                </select>
                            </td>
                            <td>
                                <select id="company_edit" class="form-control col-12">
                                    <option value="">Select Company</option>
                                    <option value="" selected>Company-1</option>
                                    <option value="">Company-2</option>
                                    <option value="">Company-3</option>
                                </select>
                            </td>
                            <td>
                                <input type="text" class="form-control col-12" id="grade_edit"  placeholder="grade" readonly>
                            </td>
                            <td>
                                <input type="text" class="form-control col-12" id="unitprice_edit"  placeholder="unit price">
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="add_name_tbl_3_btn">
                    <a href="javascript:void(0);" class="" id="add_name_edit">Save</a>
                    <a href="javascript:void(0);" class="" id="add_name_cancel" data-dismiss="modal">Cancel</a>
                </div>
            </div>
        </div>
    </div>
</div>





@section Scripts{

    <script type="text/javascript">
        let previousAssignmentRow = 2;
        function loadSingleAssignmentData(id) {

            $.ajax({
                url: '/api/Utilities/AssignmentById/'+id,
                type: 'GET',
                dataType: 'json',
                success: function (assignmentData) {

                    console.log(assignmentData);
                    $('#edit_model_span').html(assignmentData.EmployeeName);
                    $('#row_id_hidden_edit').val(id);
                    $.getJSON('/api/sections/')
                        .done(function (data) {
                            $('#section_edit').empty();
                            $('#section_edit').append(`<option value=''>Select Section</option>`);
                            $.each(data, function (key, item) {
                                if (item.Id == assignmentData.SectionId) {
                                    $('#section_edit').append(`<option value='${item.Id}' selected>${item.SectionName}</option>`);
                                }
                                else {
                                    $('#section_edit').append(`<option value='${item.Id}'>${item.SectionName}</option>`);
                                }
                                
                            });
                        });

                    $.getJSON(`/api/departments`)
                        .done(function (data) {
                            $('#department_edit').empty();
                            $('#department_edit').append(`<option value=''>Select Department</option>`);
                            $.each(data, function (key, item) {
                                if (item.Id == assignmentData.DepartmentId) {
                                    $('#department_edit').append(`<option value='${item.Id}' selected>${item.DepartmentName}</option>`);
                                }
                                else {
                                    $('#department_edit').append(`<option value='${item.Id}'>${item.DepartmentName}</option>`);
                                }
                                
                            });
                        });

                    $.getJSON('/api/incharges/')
                        .done(function (data) {
                            $('#incharge_edit').empty();
                            $('#incharge_edit').append(`<option value=''>Select In-Charge</option>`);
                            $.each(data, function (key, item) {
                                if (item.Id == assignmentData.InchargeId) {
                                    $('#incharge_edit').append(`<option value='${item.Id}' selected>${item.InChargeName}</option>`);
                                }
                                else {
                                    $('#incharge_edit').append(`<option value='${item.Id}'>${item.InChargeName}</option>`);
                                }
                                
                            });
                        });


                    $.getJSON('/api/Roles/')
                        .done(function (data) {
                            $('#role_edit').empty();
                            $('#role_edit').append(`<option value=''>Select Role</option>`);
                            $.each(data, function (key, item) {
                                if (item.Id == assignmentData.RoleId) {
                                    $('#role_edit').append(`<option value='${item.Id}' selected>${item.RoleName}</option>`);
                                }
                                else {
                                    $('#role_edit').append(`<option value='${item.Id}'>${item.RoleName}</option>`);
                                }
                                
                            });
                        });


                    $.getJSON('/api/Explanations/')
                        .done(function (data) {
                            $('#explanation_edit').empty();
                            $('#explanation_edit').append(`<option value=''>Select Explanation</option>`);
                            $.each(data, function (key, item) {
                                if (item.Id == assignmentData.ExplanationId) {
                                    $('#explanation_edit').append(`<option value='${item.Id}' selected>${item.ExplanationName}</option>`);
                                }
                                else {
                                    $('#explanation_edit').append(`<option value='${item.Id}'>${item.ExplanationName}</option>`);
                                }
                                
                            });
                        });

                    $.getJSON('/api/Companies/')
                        .done(function (data) {
                            $('#company_edit').empty();
                            $('#company_edit').append(`<option value=''>Select Company</option>`);
                            $.each(data, function (key, item) {
                                if (item.Id == assignmentData.CompanyId) {
                                    $('#company_edit').append(`<option value='${item.Id}' selected>${item.CompanyName}</option>`);
                                }
                                else {
                                    $('#company_edit').append(`<option value='${item.Id}'>${item.CompanyName}</option>`);
                                }
                                
                            });
                        });
                    $('#unitprice_edit').val(assignmentData.UnitPrice);
                    $('#grade_edit').val(assignmentData.GradeId);
                   
                },
                error: function () {
                    //$('#add_name_table_1 tbody').empty();
                }
            });



        }


        function loadSingleAssignmentDataForExistingEmployee(id) {

            previousAssignmentRow = 2
            $('#add_name_table_2 tbody').empty();
            $('#add_name_add').css('display', 'inline-block');
            $.ajax({
                url: '/api/Utilities/AssignmentById/' + id,
                type: 'GET',
                dataType: 'json',
                success: function (assignmentData) {
                    console.log(assignmentData);
                    $('#fixed_name').html(assignmentData.EmployeeName);
                    $('#fixed_hidden_name').val(assignmentData.EmployeeName);
                    $('#fixed_section').html(assignmentData.SectionName);
                    $('#fixed_department').html(assignmentData.DepartmentName);
                    $('#fixed_incharge').html(assignmentData.InchargeName);
                    $('#fixed_role').html(assignmentData.RoleName);
                    $('#fixed_explain').html(assignmentData.ExplanationName);
                    $('#fixed_company').html(assignmentData.CompanyName);
                    $('#fixed_grade').html(0);
                    $('#fixed_unitprice').html(assignmentData.UnitPrice);
                },
                error: function () {
                   
                }
            });
        }


        function addNew() {
            //<td><input class="form-control col-12" id="memo_row_${previousAssignmentRow}" readonly /></td>
        var text = `
            <tr data-id="${previousAssignmentRow}" id="row_${previousAssignmentRow}">
                <td>${previousAssignmentRow}</td>
                <td><input class="form-control col-12" id="identity_row_${previousAssignmentRow}" value="${$('#fixed_hidden_name').val()}" readonly /></td>
                <td>${previousAssignmentRow}</td>`;

            // for add new
                $.ajax({
                    url: '/api/Sections/',
                    type: 'GET',
                    async: false,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        text += '<td>';
                        text += `
                               <select id="section_row_${previousAssignmentRow}" class="form-control col-12 section_row" onChange="changeVal(${previousAssignmentRow},this)">
                                    <option value=''>Select Section</option>
                            `;
                        $.each(data, function (key, item) {
                            text += `<option value = '${item.Id}'> ${item.SectionName}</option>`;
                        });
                        text += '</select></td>';
                    },
                    error: function () {

                    }
            });


            text += `
                <td>
                    <select id="department_row_${previousAssignmentRow}" class="form-control col-12 department_row"></select>
                 </td>
                `;

            $.ajax({
                url: '/api/incharges/',
                type: 'GET',
                async: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    text += '<td>';
                    text += `
                               <select id="incharge_row_${previousAssignmentRow}" class="form-control col-12">
                                    <option value=''>Select In-Charge</option>
                            `;
                    $.each(data, function (key, item) {
                        text += `<option value = '${item.Id}'> ${item.InChargeName}</option>`;
                    });
                    text += '</select></td>';
                },
                error: function () {

                }
            });

            $.ajax({
                url: '/api/roles/',
                type: 'GET',
                async: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    text += '<td>';
                    text += `
                               <select id="role_row_${previousAssignmentRow}" class="form-control col-12">
                                    <option value=''>Select Role</option>
                            `;
                    $.each(data, function (key, item) {
                        text += `<option value = '${item.Id}'> ${item.RoleName}</option>`;
                    });
                    text += '</select></td>';
                },
                error: function () {

                }
            });

            $.ajax({
                url: '/api/Explanations/',
                type: 'GET',
                async: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    text += '<td>';
                    text += `
                               <select id="explain_row_${previousAssignmentRow}" class="form-control col-12">
                                    <option value=''>Select Role</option>
                            `;
                    $.each(data, function (key, item) {
                        text += `<option value = '${item.Id}'> ${item.ExplanationName}</option>`;
                    });
                    text += '</select></td>';
                },
                error: function () {

                }
            });  

            $.ajax({
                url: '/api/Companies/',
                type: 'GET',
                async: false,
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    text += '<td>';
                    text += `
                               <select id="company_row_${previousAssignmentRow}" class="form-control col-12">
                                    <option value=''>Select Role</option>
                            `;
                    $.each(data, function (key, item) {
                        text += `<option value = '${item.Id}'> ${item.CompanyName}</option>`;
                    });
                    text += '</select></td>';
                },
                error: function () {

                }
            }); 
            text += `
                 <td><input class="form-control col-12" id="grade_row_${previousAssignmentRow}" readonly /></td>
                 <td><input class="form-control col-12" id="unitprice_row_${previousAssignmentRow}" onChange="unitPriceChange(${previousAssignmentRow},this)"/></td>
                 <td><a href='javascript:void(0);' onClick="removeTr(${previousAssignmentRow})">remove</a></td>
            </tr>

            `;

            $('#add_name_table_2 tbody').append(text);



            previousAssignmentRow++;
        }

        function removeTr(rowId) {
            var rowElement = $('#row_' + rowId);
            rowElement.remove();
            //console.log();
            //$('#add_name_table_2 tbody').remove(rowElement);
        }
       
        function changeVal(rowId, element) {

            var sectionId = $(element).val();

            $.ajax({
                url: `/api/utilities/DepartmentsBySection/${sectionId}`,
                type: 'GET',
                async: false,
                dataType: 'json',
                success: function (data) {
                    $('#department_row_' + rowId).empty();
                    $('#department_row_' + rowId).append(`<option value=''>Select Department</option>`);
                    $.each(data, function (key, item) {
                        $('#department_row_' + rowId).append(`<option value='${item.Id}'>${item.DepartmentName}</option>`);
                    });
                },
                error: function () {

                }
            }); 


        }


        function unitPriceChange(rowId,element) {
            let _unitPrice = $(element).val();

            $.ajax({
                url: `/api/utilities/CompareGrade/${_unitPrice}`,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    console.log(data);
                    $('#grade_row_' + rowId).attr('data-id', data.Id);
                    $('#grade_row_' + rowId).val(data.SalaryGrade);
                },
                error: function () {

                }
            });
        }

        function onSave(){
            const rows = document.querySelectorAll("#add_name_table_2 > tbody > tr");
            $('#add_name_add').css('display','none');
            console.log(rows);
            $.each(rows, function (index, data) {
                var rowId = data.dataset.id;

                var employeeName = $('#identity_row_' + rowId).val();
                var sectionId = $('#section_row_' + rowId).find(":selected").val();
                var departmentId = $('#department_row_' + rowId).find(":selected").val();
                var inchargeId = $('#incharge_row_' + rowId).find(":selected").val();
                var roleId = $('#role_row_' + rowId).find(":selected").val();
                var companyId = $('#company_row_' + rowId).find(":selected").val();
                var explanationId = $('#explain_row_' + rowId).find(":selected").val();
                var unitPrice = $('#unitprice_row_' + rowId).val();
                var gradeId = $('#grade_row_' + rowId).data('id');



                var data = {
                    EmployeeName: employeeName,
                    SectionId: sectionId,
                    DepartmentId: departmentId,
                    InchargeId: inchargeId,
                    RoleId: roleId,
                    ExplanationId: explanationId,
                    CompanyId: companyId,
                    UnitPrice: unitPrice,
                    GradeId: gradeId,

                };

                console.log(data);

                $.ajax({
                    url: '/api/Employees',
                    type: 'POST',
                    async: false,
                    dataType: 'json',
                    data: data,
                    success: function (data) {

                        Command: toastr["success"](data, "Success")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "3000",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        //$('#modal_add_name_new').modal('toggle');
                    },
                    error: function () {
                        alert("Error please try again");
                        //$('#modal_add_name_new').modal('toggle');
                    }
                });
            });

        }


        $(document).ready(function () {


            // for add new
            $.getJSON('/api/Roles/')
                .done(function (data) {
                    $('#role_new').empty();
                    $('#role_new').append(`<option value=''>Select Role</option>`);
                    $.each(data, function (key, item) {
                        $('#role_new').append(`<option value='${item.Id}'>${item.RoleName}</option>`);
                    });
                });
            // for search
            $.getJSON('/api/Roles/')
                .done(function (data) {
                    $('#role_search').empty();
                    $('#role_search').append(`<option value=''>Select Role</option>`);
                    $.each(data, function (key, item) {
                        $('#role_search').append(`<option value='${item.Id}'>${item.RoleName}</option>`);
                    });
                });
            // for add new
                $.getJSON('/api/Explanations/')
                    .done(function (data) {
                        $('#explanation_new').empty();
                        $('#explanation_new').append(`<option value=''>Select Explanation</option>`);
                        $.each(data, function (key, item) {
                            $('#explanation_new').append(`<option value='${item.Id}'>${item.ExplanationName}</option>`);
                        });
                });
            // for search
            $.getJSON('/api/Explanations/')
                .done(function (data) {
                    $('#explanation_search').empty();
                    $('#explanation_search').append(`<option value=''>Select Explanation</option>`);
                    $.each(data, function (key, item) {
                        $('#explanation_search').append(`<option value='${item.Id}'>${item.ExplanationName}</option>`);
                    });
                });
            // for add new
                $.getJSON('/api/Companies/')
                    .done(function (data) {
                        $('#company_new').empty();
                        $('#company_new').append(`<option value=''>Select Company</option>`);
                        $.each(data, function (key, item) {
                            $('#company_new').append(`<option value='${item.Id}'>${item.CompanyName}</option>`);
                        });
                });
             // for search
            $.getJSON('/api/Companies/')
                .done(function (data) {
                    $('#company_search').empty();
                    $('#company_search').append(`<option value=''>Select Company</option>`);
                    $.each(data, function (key, item) {
                        $('#company_search').append(`<option value='${item.Id}'>${item.CompanyName}</option>`);
                    });
                });

            // for add new
                $.getJSON('/api/incharges/')
                    .done(function (data) {
                        $('#incharge_new').empty();
                        $('#incharge_new').append(`<option value=''>Select In-Charge</option>`);
                        $.each(data, function (key, item) {
                            $('#incharge_new').append(`<option value='${item.Id}'>${item.InChargeName}</option>`);
                        });
                });
            // for search
            $.getJSON('/api/incharges/')
                .done(function (data) {
                    $('#incharge_search').empty();
                    $('#incharge_search').append(`<option value=''>Select In-Charge</option>`);
                    $.each(data, function (key, item) {
                        $('#incharge_search').append(`<option value='${item.Id}'>${item.InChargeName}</option>`);
                    });
                });
            // for add new
                $.getJSON('/api/sections/')
                    .done(function (data) {
                        $('#section_new').empty();
                        $('#section_new').append(`<option value=''>Select Section</option>`);
                        $.each(data, function (key, item) {
                            $('#section_new').append(`<option value='${item.Id}'>${item.SectionName}</option>`);
                        });
                });
            // for search 
                $.getJSON('/api/sections/')
                    .done(function (data) {
                        $('#section_search').empty();
                        $('#section_search').append(`<option value=''>Select Section</option>`);
                        $.each(data, function (key, item) {
                            $('#section_search').append(`<option value='${item.Id}'>${item.SectionName}</option>`);
                        });
                    });


            $(document).on('change', '#section_edit', function () {

                var sectionId = $(this).val();
                console.log(sectionId);

                $.getJSON(`/api/utilities/DepartmentsBySection/${sectionId}`)
                    .done(function (data) {
                        $('#department_edit').empty();
                        $('#department_edit').append(`<option value=''>Select Department</option>`);
                        $.each(data, function (key, item) {
                            $('#department_edit').append(`<option value='${item.Id}'>${item.DepartmentName}</option>`);
                        });
                    });
            });


            $(document).on('change','#section_new', function () {

                var sectionId = $(this).val();
                console.log(sectionId);

                $.getJSON(`/api/utilities/DepartmentsBySection/${sectionId}`)
                    .done(function (data) {
                        $('#department_new').empty();
                        $('#department_new').append(`<option value=''>Select Department</option>`);
                        $.each(data, function (key, item) {
                            $('#department_new').append(`<option value='${item.Id}'>${item.DepartmentName}</option>`);
                        });
                    });
            });

            $(document).on('change', '#section_search', function () {

                var sectionId = $(this).val();
                console.log(sectionId);

                $.getJSON(`/api/utilities/DepartmentsBySection/${sectionId}`)
                    .done(function (data) {
                        $('#department_search').empty();
                        $('#department_search').append(`<option value=''>Select Department</option>`);
                        $.each(data, function (key, item) {
                            $('#department_search').append(`<option value='${item.Id}'>${item.DepartmentName}</option>`);
                        });
                    });
            });

            $('#unitprice_new').on('change', function () {
                var _unitPrice = $(this).val();

                $.ajax({
                    url: `/api/utilities/CompareGrade/${_unitPrice}`,
                    type: 'GET',
                    dataType: 'json',
                    //data: {
                    //    unitPrice: _unitPrice
                    //},
                    success: function (data) {
                        console.log(data);
                        $('#grade_new').attr('data-id', data.Id);
                        $('#grade_new').val(data.SalaryGrade);
                    },
                    error: function () {
                       
                    }
                });
            });

            $('#unitprice_edit').on('change', function () {
                var _unitPrice = $(this).val();

                $.ajax({
                    url: `/api/utilities/CompareGrade/${_unitPrice}`,
                    type: 'GET',
                    dataType: 'json',
                    //data: {
                    //    unitPrice: _unitPrice
                    //},
                    success: function (data) {
                        console.log(data);
                        $('#grade_edit').attr('data-id', data.Id);
                        $('#grade_edit').val(data.SalaryGrade);
                    },
                    error: function () {

                    }
                });
            });




            $('#add_name_search_button').on('click', function () {
                var sectionId = $('#section_search').find(":selected").val();
                var inchargeId = $('#incharge_search').find(":selected").val();
                var departmentId = $('#department_search').find(":selected").val();
                var roleId = $('#role_search').find(":selected").val();
                var companyId = $('#company_search').find(":selected").val();
                var explanationId = $('#explanation_search').find(":selected").val();
                var employeeName = $('#identity_search').val();

                if (departmentId == undefined) {
                    departmentId = '';
                }
                var data_info = { employeeName: employeeName, sectionId: sectionId, departmentId: departmentId, inchargeId: inchargeId, roleId: roleId, explanationId: explanationId, companyId: companyId, status: '' };
                $.ajax({
                    url: `/api/utilities/SearchEmployee`,
                    type: 'GET',
                    dataType: 'json',
                    data: data_info,
                    success: function (data) {

                        console.log(data);
                        //$('#modal_add_name_new').modal('toggle');
                        $('#add_name_table_1 tbody').empty();
                        var i = 1;
                        $.each(data, function (index,item) {    
                            $('#add_name_table_1 tbody').append(`<tr data-id="${item.Id}">`);
                            $('#add_name_table_1 tbody').append(`<td>${i}</td><td>${item.EmployeeName}</td><td></td><td>${item.SectionName}</td><td>${item.DepartmentName}</td><td>${item.InchargeName}</td><td>${item.RoleName}</td><td>${item.ExplanationName}</td><td>${item.CompanyName}</td><td>${item.GradePoint}</td><td>${item.UnitPrice}</td><td class="add_name_btn_group"><a href="javascript:void(0);" onClick="loadSingleAssignmentDataForExistingEmployee(${item.Id})" class="link_add" data-toggle="modal" data-target="#modal_add_name">add</a> <a href="javascript:void(0);" onClick="loadSingleAssignmentData(${item.Id})" data-toggle="modal" data-target="#modal_edit_name">edit</a></td>`);
                            $('#add_name_table_1 tbody').append('</tr>');
                            i++;
                        });
                    },
                    error: function () {
                        $('#add_name_table_1 tbody').empty();
                    }
                });


            });

            $('#add_name_add_new').on('click', function () {

                var employeeName = $('#identity_new').val();
                var sectionId = $('#section_new').find(":selected").val();
                var inchargeId = $('#incharge_new').find(":selected").val();
                var departmentId = $('#department_new').find(":selected").val();
                var roleId = $('#role_new').find(":selected").val();
                var companyId = $('#company_new').find(":selected").val();
                var explanationId = $('#explanation_new').find(":selected").val();
                var unitPrice = $('#unitprice_new').val();
                var gradeId = $('#grade_new').data('id');



                var data = {
                    EmployeeName: employeeName,
                    SectionId: sectionId,
                    DepartmentId: departmentId,
                    InchargeId: inchargeId ,
                    RoleId: roleId,
                    ExplanationId: explanationId,
                    CompanyId: companyId,
                    UnitPrice: unitPrice,
                    GradeId: gradeId,
                    
                };

                console.log(data);

                $.ajax({
                    url: '/api/Employees',
                    type: 'POST',
                    dataType: 'json',
                    data: data,
                    success: function (data) {

                        Command: toastr["success"](data, "Success")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "3000",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        $('#modal_add_name_new').modal('toggle');
                    },
                    error: function () {
                        alert("Error please try again");
                        //$('#modal_add_name_new').modal('toggle');
                    }
                });

               

            });

            $('#add_name_edit').on('click', function () {

                var sectionId = $('#section_edit').find(":selected").val();
                var inchargeId = $('#incharge_edit').find(":selected").val();
                var departmentId = $('#department_edit').find(":selected").val();
                var roleId = $('#role_edit').find(":selected").val();
                var companyId = $('#company_edit').find(":selected").val();
                var explanationId = $('#explanation_edit').find(":selected").val();
                var unitPrice = $('#unitprice_edit').val();
                var gradeId = $('#grade_edit').val();
                var rowId = $('#row_id_hidden_edit').val();


                var dataSingleAssignmentUpdate = {
                    Id: rowId,
                    SectionId: sectionId,
                    DepartmentId: departmentId,
                    InchargeId: inchargeId,
                    RoleId: roleId,
                    ExplanationId: explanationId,
                    CompanyId: companyId,
                    UnitPrice: unitPrice,
                    GradeId: gradeId,

                };

                console.log(dataSingleAssignmentUpdate);

                $.ajax({
                    url: '/api/Employees',
                    type: 'PUT',
                    dataType: 'json',
                    data: dataSingleAssignmentUpdate,
                    success: function (data) {

                        Command: toastr["success"](data, "Success")

                        toastr.options = {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": false,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "3000",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        }
                        $('#modal_add_name_new').modal('toggle');
                    },
                    error: function () {
                        alert("Error please try again");
                        //$('#modal_add_name_new').modal('toggle');
                    }
                });



            });


    });
    </script>

}

